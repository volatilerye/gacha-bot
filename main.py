import os

import discord
from dotenv import load_dotenv

from gacha import gacha

load_dotenv()

TOKEN = os.getenv("DISCORD_BOT_TOKEN", "")
CHANNEL_ID = os.getenv("CHANNEL_ID", "")

intents = discord.Intents.default()
intents.message_content = True

client = discord.Client(intents=intents)


@client.event
async def on_ready():
    print(f"logged in as {client.user}")


@client.event
async def on_message(message: discord.message.Message):
    # do not respond to bot messages
    if message.author.bot:
        return

    # respond only selected channel
    print(
        type(message),
    )
    if message.channel.id != int(CHANNEL_ID):
        return

    if message.content.startswith("!gacha"):
        try:
            response = gacha(message.content.split("\n", maxsplit=1)[1])
        except Exception:
            response = (
                "âŒ **å¤±æ•—**: å…¥åŠ›æ–¹æ³•ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼\n"
                '"?gacha" ã‚³ãƒãƒ³ãƒ‰ã§ä½¿ã„æ–¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„'
            )

        await message.channel.send(response)
    elif message.content == "?gacha":
        response = (
            "## ğŸ’¸ ã‚¬ãƒãƒ£ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿\n"
            "å¼•ããŸã„ã‚¬ãƒãƒ£ã‚’æƒãˆã‚‹ã®ã«å¿…è¦ãªå›æ•°ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã‚ˆã†ï¼\n\n"
            "```\n"
            "!gacha\n"
            "ã‚¢ã‚¤ãƒ†ãƒ å, å‡ºç¾ç¢ºç‡ [, å¿…è¦æ•°] [, é‡è¤‡æ•°]\n"
            "... (è¤‡æ•°ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æŒ‡å®šã™ã‚‹å ´åˆ2è¡Œç›®ã¨åŒæ§˜)\n"
            "```\n"
            "- **ã‚¢ã‚¤ãƒ†ãƒ å** (æ–‡å­—åˆ—): ã‚¢ã‚¤ãƒ†ãƒ ã®åå‰\n"
            "    - å˜ãªã‚‹ãƒ©ãƒ™ãƒ«ã§ã‚ã‚Š, ãã‚Œãã‚Œã®è¡Œã¯åå‰ãŒåŒã˜ã§ã‚‚é•ã†ã‚¢ã‚¤ãƒ†ãƒ ã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹)\n"
            "- **å‡ºç¾ç¢ºç‡** (æ•°å€¤): ã‚¢ã‚¤ãƒ†ãƒ ã®å‡ºç¾ç¢ºç‡ (å°‘æ•°oråˆ†æ•°, 0<pâ‰¤1), ã¾ãŸã¯å‡ºç¾ç¢ºç‡ã®æ•´æ•°æ¯” (1ä»¥ä¸Šã®æ•´æ•°)\n"
            "    - ã™ã¹ã¦ã®å‡ºç¾ç¢ºç‡ã¯ 0<pâ‰¤1 ã®ç¢ºç‡è¡¨è¨˜, ã‚ã‚‹ã„ã¯æ•´æ•°æ¯”ã®è¡¨è¨˜ã®ã©ã¡ã‚‰ã‹ã«çµ±ä¸€ã™ã‚‹ã“ã¨\n"
            "- **å¿…è¦å€‹æ•°** (æ•°å€¤): åé›†ã«å¿…è¦ãªæ•° (0ä»¥ä¸Šã®æ•´æ•°). çœç•¥ã—ãŸå ´åˆã¯1.\n"
            "- **é‡è¤‡æ•°** (æ•°å€¤): ç¾åœ¨è¡Œã‚’ã„ãã¤ã«è¤‡è£½ã™ã‚‹ã‹ (1ä»¥ä¸Šã®æ•´æ•°). çœç•¥ã—ãŸå ´åˆã¯1.\n"
            "    - ä¾‹ãˆã° `ã‚¢ã‚¤ãƒ†ãƒ A, 0.1, 1, 2` ã¨æŒ‡å®šã—ãŸå ´åˆ, `ã‚¢ã‚¤ãƒ†ãƒ A, 0.1, 1` ã‚’2è¡Œåˆ†æ›¸ã„ãŸã®ã¨åŒæ§˜.\n"
            "  - é‡è¤‡æ•°ã‚’æŒ‡å®šã™ã‚‹å ´åˆã¯å¿…è¦å€‹æ•°ã‚‚å¿…é ˆ\n"
            "### âœï¸ ä¾‹: é«˜ãƒ¬ã‚¢ãªæ¨ã—ã‚­ãƒ£ãƒ©ã¨ä½ãƒ¬ã‚¢ã®ä¸ç‰¹å®šã®ã‚­ãƒ£ãƒ©ã‚’é›†ã‚ã‚‹ã¨ã\n"
            "```\n"
            "!gacha\n"
            "â˜…5æ¨ã—, 0.001\n"
            "â˜…4æ¨ã—, 1/100  (â˜œ å‡ºç¾ç¢ºç‡ã¯åˆ†æ•°ã§ã‚‚å°‘æ•°ã§ã‚‚è‰¯ã„)\n"
            "â˜…3æ¨ã—, 2/100, 1, 3  (â˜œ ç‰¹å®šã®â˜…3æ¨ã—ã‚­ãƒ£ãƒ©ã‚’1ä½“ãšã¤)\n"
            "â˜…2ã‚­ãƒ£ãƒ©, 30/100, 3  (â˜œ ä¸ç‰¹å®šã®â˜…2ã‚­ãƒ£ãƒ©ã‚’3ä½“)\n"
            "```\n"
            "ã‚ã‚‹ã„ã¯ã®ã‚ˆã†ã«æ›¸ã„ã¦ã‚‚çµæœã¯åŒã˜\n"
            "```\n"
            "!gacha\n"
            "â˜…5æ¨ã—, 1  (â˜œ å‡ºç¾ç¢ºç‡ã‚’å…¨ä½“ã®æ•´æ•°æ¯”ã§è¡¨ã—ã¦ã„ã‚‹)\n"
            "â˜…4æ¨ã—, 10\n"
            "â˜…3æ¨ã—A, 20, 1  (â˜œ é‡è¤‡æ•°ã«ã‚ˆã‚‹è¤‡è£½)\n"
            "â˜…3æ¨ã—B, 20, 1\n"
            "â˜…3æ¨ã—C, 20, 1\n"
            "â˜…2ã‚­ãƒ£ãƒ©, 300, 3\n"
            "â˜…1ã‚­ãƒ£ãƒ©, 629, 0  (â˜œ å¿…è¦æ•°ãŒ0ãªã®ã§å¼•ã„ã¦ã‚‚åŠ¹æœãŒãªã„)\n"
            "```\n"
            "```\n"
            "1%: 63å›\n"
            "5%: 112å›\n"
            "10%: 157å›\n"
            "20%: 251å›\n"
            "25%: 307å›\n"
            "50%: 694å›\n"
            "75%: 1386å›\n"
            "80%: 1609å›\n"
            "90%: 2302å›\n"
            "95%: 2995å›\n"
            "99%: 4603å›\n"
            "å¹³å‡: 1012.43å›\n"
            "æ¨™æº–åå·®: 989.11å›\n"
            "æœ€é »å€¤: 151å›\n"
            "```\n"
            "â†‘ ã€Œâ—‹â—‹%: xxå›ã€ã¯, xxå›å¼•ã‘ã°â—‹â—‹%ã®ç¢ºç‡ã§ã‚¢ã‚¤ãƒ†ãƒ ãŒæƒã†ã¨ã„ã†æ„å‘³\n\n"
            "### âš ï¸ æ³¨æ„\n"
            "è¨ˆç®—ã®çµ„ã¿åˆã‚ã›çˆ†ç™ºãŒèµ·ãã‚„ã™ã„ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã™ã‚‹ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã™...\n"
            "- ã‚ã¾ã‚Šã«ã‚‚å‡ºç¾ç¢ºç‡ãŒä½ã™ãã‚‹ã‚¢ã‚¤ãƒ†ãƒ \n"
            "- ç•°ãªã‚‹ã‚¢ã‚¤ãƒ†ãƒ /å‡ºç¾ç¢ºç‡/å¿…è¦æ•°ã®çµ„ã¿åˆã‚ã›ãŒå¤šã™ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³"
        )
        await message.channel.send(response)


client.run(TOKEN)
