import os

import discord
from dotenv import load_dotenv

from gacha import gacha

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€
load_dotenv()

# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹
TOKEN = os.getenv("DISCORD_BOT_TOKEN")

# ã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦åå¿œã™ã‚‹Intentsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
intents = discord.Intents.default()
intents.message_content = True  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã‚’å—ã‘å–ã‚‹ãŸã‚ã®æ¨©é™ã‚’ä»˜ä¸

# Discordã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
client = discord.Client(intents=intents)


@client.event
async def on_ready():
    print(f"{client.user}ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ")


@client.event
async def on_message(message):
    # Botè‡ªèº«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯åå¿œã—ãªã„ã‚ˆã†ã«ã™ã‚‹
    if message.author.bot:
        return

    if message.content.startswith("!gacha"):
        # å¿œç­”ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ
        try:
            response = gacha(message.content.split("\n", maxsplit=1)[1])
        except Exception as e:
            responce = f"âŒ å¤±æ•—: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼\n```\n{e}\n```"

        await message.channel.send(response)
    elif message.content == "?gacha":
        response = (
            "## ğŸ’¸ ã‚¬ãƒãƒ£ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿\n"
            "å¼•ããŸã„ã‚¬ãƒãƒ£ã‚’æƒãˆã‚‹ã®ã«å¿…è¦ãªå›æ•°ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã‚ˆã†ï¼\n\n"
            "### âœï¸ ä¾‹: å‡ºç¾ç¢ºç‡0.01(=1%) ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’1å€‹ã‚²ãƒƒãƒˆã™ã‚‹ã®ã«ä½•å›ã‚¬ãƒãƒ£ãŒå¿…è¦ï¼Ÿ\n"
            "```\n"
            "!gacha\n"
            "ã‚¢ã‚¤ãƒ†ãƒ A, 0.01  (â˜œ [ã‚¢ã‚¤ãƒ†ãƒ å], [å‡ºç¾ç¢ºç‡], [å¿…è¦æ•° (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)])\n"
            "```\n"
            "```\n"
            "1%: 1å›\n"
            "5%: 6å›\n"
            "10%: 11å›\n"
            "20%: 23å›\n"
            "25%: 29å›\n"
            "50%: 69å›\n"
            "75%: 138å›\n"
            "80%: 161å›\n"
            "90%: 230å›\n"
            "95%: 299å›\n"
            "99%: 459å›\n"
            "å¹³å‡: 100.00å›\n"
            "æ¨™æº–åå·®: 99.50å›\n"
            "æœ€é »å€¤: 1å›\n"
            "```\n"
            "â†‘ ã€Œâ—‹â—‹%: xxå›ã€ã¯, xxå›å¼•ã‘ã°â—‹â—‹%ã®ç¢ºç‡ã§ã‚¢ã‚¤ãƒ†ãƒ ãŒæƒã†ã¨ã„ã†æ„å‘³ã§ã™\n\n"
            "### âœ¨ å¿œç”¨\n"
            "ã‚¢ã‚¤ãƒ†ãƒ ã¯è¤‡æ•°æŒ‡å®šã§ãã‚‹ãï¼"
            "```\n"
            "!gacha\n"
            "ã‚¢ã‚¤ãƒ†ãƒ A, 0.1\n"
            "ã‚¢ã‚¤ãƒ†ãƒ B, 1/100  (â˜œåˆ†æ•°è¡¨è¨˜ã‚‚å¯ï¼)\n"
            "ã‚¢ã‚¤ãƒ†ãƒ C, 1/1000, 2  (â˜œ3ç•ªç›®ã®å€¤ã§å¿…è¦æ•°ã‚‚å¤‰æ›´å¯ï¼)\n"
            "```\n"
            "### âš ï¸ æ³¨æ„\n"
            "ã‚µãƒ¼ãƒã§ã‚´ãƒªã‚´ãƒªã®è¡Œåˆ—è¨ˆç®—ã‚’ã—ã¦ã„ã‚‹éƒ½åˆä¸Šã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã™ã‚‹ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã™...\n"
            "- ã‚ã¾ã‚Šã«ã‚‚å‡ºç¾ç¢ºç‡ãŒä½ã™ãã‚‹ã‚¢ã‚¤ãƒ†ãƒ \n"
            "- ç•°ãªã‚‹ã‚¢ã‚¤ãƒ†ãƒ /å‡ºç¾ç¢ºç‡/å¿…è¦æ•°ã®çµ„ã¿åˆã‚ã›ãŒå¤šã™ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³"
        )
        await message.channel.send(response)


client.run(TOKEN)
